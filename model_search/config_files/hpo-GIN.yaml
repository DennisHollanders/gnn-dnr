# GIN-specific HPO Configuration for Distribution Network Reconfiguration
# Usage: python hpo.py --config hpo-gin.yaml --trials 100

description: "GIN Architecture HPO for Distribution Network Reconfiguration"
job_name: "hpo_gin_dnr"

# ============================================================================
# DATA CONFIGURATION
# ============================================================================
dataset_names: ["train", "validation", "test"]
folder_names: 
  - "data\\split_datasets\\train"
  - "data\\split_datasets\\validation"
  - "data\\split_datasets\\test"

dataset_type: "cvx"
batching_type: "standard"
max_nodes: 32000
max_edges: 35000
train_ratio: 0.85
seed: 42
num_workers: 1

# ============================================================================
# MODEL CONFIGURATION
# ============================================================================
model_module: "AdvancedMLP"
epochs: 80
patience: 8
evaluate_every_x_epoch: 5
criterion_name: "MSELoss"  # Will be tracked in parallel coordinates

# ============================================================================
# GIN-SPECIFIC SEARCH SPACE
# ============================================================================
# We only use stage_1, stage_2 is dummy to satisfy the two-stage HPO code
stage_1_search_space:
  # Training hyperparameters
  learning_rate:
    search_type: float
    min: 0.00001
    max: 0.001
    log: true
  
  weight_decay:
    search_type: float
    min: 0.000001
    max: 0.0001
    log: true
  
  batch_size:
    search_type: categorical
    choices: [8, 16, 32, 64]
  
  dropout_rate:
    search_type: float
    min: 0.0
    max: 0.4
  
  activation:
    search_type: categorical
    choices: ["relu", "leaky_relu", "elu", "gelu"]
  
  # GNN Architecture - FIXED TO GIN
  gnn_type:
    search_type: categorical
    choices: ["GIN"]  # Fixed to GIN
  
  gnn_layers:
    search_type: int
    min: 1
    max: 5  # GIN often works well with deeper architectures
  
  gnn_hidden_dim:
    search_type: int
    min: 32
    max: 256
    step: 32
  
  # GAT-specific (not used for GIN, but needed for model initialization)
  gat_heads:
    search_type: categorical
    choices: [4]  # Default value
  
  gat_dropout:
    search_type: categorical
    choices: [0.0]  # Default value
  
  # GIN-specific parameters
  gin_eps:
    search_type: float
    min: 0.0
    max: 0.2  # Learning the epsilon parameter
  
  # MLP Components
  use_node_mlp:
    search_type: categorical
    choices: [true, false]
  
  use_edge_mlp:
    search_type: categorical
    choices: [true, false]
  
  # Dynamic hidden dimensions for MLPs
  node_hidden_dims:
    search_type: dynamic
    n_layers_min: 1
    n_layers_max: 3
    dim_min: 32
    dim_max: 256
    dim_step: 32
  
  edge_hidden_dims:
    search_type: dynamic
    n_layers_min: 1
    n_layers_max: 3
    dim_min: 32
    dim_max: 256
    dim_step: 32
  
  # Advanced features
  use_batch_norm:
    search_type: categorical
    choices: [true, false]
  
  use_residual:
    search_type: categorical
    choices: [true, false]
  
  pooling:
    search_type: categorical
    choices: ["mean", "max", "add", "attention"]

# ============================================================================
# HPO PROCESS SETTINGS
# ============================================================================
hp_search: true
wandb: true

# W&B settings for experiment tracking
wandb_settings:
  project: "DNR-HPO"
  group: "gin_architecture_search"
  tags: ["hpo", "advanced_mlp", "gin"]
  
# Metrics to track (ensure these appear in parallel coordinates)
metrics_to_log:
  - "loss"  # MSE or BCE loss
  - "val_loss"
  - "f1_score"
  - "val_f1_score"
  - "precision"
  - "recall"
  - "accuracy"
  - "learning_rate"
  - "weight_decay"
  - "batch_size"
  - "dropout_rate"
  - "activation"
  - "gnn_layers"
  - "gnn_hidden_dim"
  - "gin_eps"
  - "use_node_mlp"
  - "use_edge_mlp"
  - "use_batch_norm"
  - "use_residual"
  - "pooling"

# ============================================================================
# DUMMY STAGE 2 (NOT USED - Just to satisfy two-stage code)
# ============================================================================
stage_2_search_space:
  learning_rate:
    search_type: categorical
    choices: [0.001]  # Dummy value